
from shapely.geometry import Polygon
import xml.etree.ElementTree as ET


# ==== INPUT DATA ====
coords = [
    (1739041.8462071866, 665173.5919693112),
    (1739228.1163589805, 664811.8655387759),
    (1739246.598731324, 664821.382991761),
    (1739262.9143650532, 664789.6989248544),
    (1739244.4319926798, 664780.1814718395),
    (1739296.7779842466, 664678.5284238607),
    (1739283.5762896836, 664671.7302431166),
    (1739301.9313776493, 664636.0856678486),
    (1739261.006124556, 664615.0113076121),
    (1739246.0501269698, 664644.055035606),
    (1738328.5323560238, 664171.5814755112),
    (1738065.4427621067, 664682.4870544076),
    (1738853.583926484, 665088.338443473),
    (1738858.3426529914, 665079.0972572863),
    (1739041.8462071866, 665173.5919693112),
    (1738844.0792871267, 664938.1331612021),
    (1738829.5574231297, 664930.6551623791),
    (1738837.0354219228, 664916.1332983971),
    (1738851.5572859347, 664923.6112971604),
    (1738844.0792871267, 664938.1331612021),
    (1739126.8451641947, 664895.0056320727),
    (1739146.6477060318, 664905.2029031515),
    (1739136.4504349232, 664925.0054449588),
    (1739120.6084014773, 664916.8476280868),
    (1739117.2093111128, 664923.4484753609),
    (1739130.4110056758, 664930.2466560751),
    (1739117.4944622964, 664955.3298757225),
    (1739121.4549706876, 664957.3693299294),
    (1739095.6218839288, 665007.5357692093),
    (1739091.6613755524, 665005.4963150024),
    (1739078.744832173, 665030.5795346498),
    (1739058.9422903657, 665020.3822635412),
    (1739068.4597433805, 665001.8998911977),
    (1739075.0605906546, 665005.2989815623),
    (1739107.012040034, 664943.251017198),
    (1739093.8103455007, 664936.4528364688),
    (1739116.924159944, 664891.5670749992),
    (1739107.6829737574, 664886.8083484918),
    (1739151.1913303733, 664802.3175034076),
    (1739165.7131943703, 664809.7955022156),
    (1739190.8664630353, 664760.9492323846),
    (1739198.787479788, 664765.028140828),
    (1739185.8709364086, 664790.1113604456),
    (1739201.7129698694, 664798.2691773176),
    (1739191.5156987906, 664818.0717191547),
    (1739169.0728180408, 664806.5148119181),
    (1739165.6737276763, 664813.1156591922),
    (1739188.1166084409, 664824.6725664139),
    (1739177.2395192683, 664845.7952776849),
    (1739153.4764690846, 664833.5585523993),
    (1739150.07737872, 664840.1593996584),
    (1739173.8404289037, 664852.3961249441),
    (1739163.6431578249, 664872.1986667812),
    (1739135.9195992649, 664857.9224872589),
    (1739125.722328186, 664877.7250290662),
    (1739131.0030060261, 664880.4443013668),
    (1739137.8011867404, 664867.2426068187),
    (1739161.564236924, 664879.479332149),
    (1739151.3669658601, 664899.2818739414),
    (1739124.963576749, 664885.6855124831),
    (1739114.7663056701, 664905.4880543202),
    (1739120.0469834805, 664908.2073266208),
    (1739126.8451641947, 664895.0056320727),
    (1738939.6879508048, 664716.7877107263),
    (1738933.0871035457, 664713.3886203766),
    (1738943.2843746245, 664693.5860785693),
    (1738956.4860691875, 664700.3842592835),
    (1738910.258440271, 664790.155782178),
    (1738903.657592982, 664786.7566918284),
    (1738939.6879508048, 664716.7877107263),
    (1738991.590924427, 664596.533890292),
    (1738996.871602267, 664599.2531625777),
    (1738993.4725119025, 664605.8540098518),
    (1738988.1918340921, 664603.134737581),
    (1738991.590924427, 664596.533890292),
    (1738980.2708173394, 664599.0558291376),
    (1738988.1918340921, 664603.134737581),
    (1738950.1220220327, 664677.0642270297),
    (1738942.2010053247, 664672.9853186011),
    (1738980.2708173394, 664599.0558291376),
    (1738950.1220220327, 664677.0642270297),
    (1738951.4421914816, 664677.7440451086),
    (1738943.2843746245, 664693.5860785693),
    (1738941.9642051607, 664692.9062604755),
    (1738950.1220220327, 664677.0642270297),
    (1738862.1798062474, 664812.1645293236),
    (1738879.3420091718, 664821.0021642745),
    (1738872.5438284427, 664834.2038588077),
    (1738863.302642256, 664829.4451323003),
    (1738834.7502832115, 664884.8922493905),
    (1738826.8292665035, 664880.8133409768),
    (1738862.1798062474, 664812.1645293236),
    (1738834.7502832115, 664884.8922493905),
    (1738836.0704526901, 664885.5720674843),
    (1738833.3511803895, 664890.8527452946),
    (1738832.0310109407, 664890.1729272306),
    (1738834.7502832115, 664884.8922493905),
    (1738833.3511803895, 664890.8527452946),
    (1738843.91253604, 664896.291289866),
    (1738836.434537232, 664910.813153863),
    (1738825.8731816262, 664905.3746092916),
    (1738833.3511803895, 664890.8527452946),
    (1738836.434537232, 664910.813153863),
    (1738839.0748761296, 664912.1727900058),
    (1738837.0354219228, 664916.1332983971),
    (1738834.395083025, 664914.7736622393),
    (1738836.434537232, 664910.813153863)
]

z_min_ft = 450.919504583
z_max_ft = 586.640033667
feet_to_m = 0.3048

# ==== GEOMETRY ====
poly = Polygon(coords)
hull = poly.convex_hull

# Get convex hull coordinates and close the polygon explicitly
hull_coords = list(hull.exterior.coords)
if hull_coords[0] != hull_coords[-1]:
    hull_coords.append(hull_coords[0])

# Convert coordinates to meters and shift to origin (optional)
minx = min(x for x, y in hull_coords)
miny = min(y for x, y in hull_coords)
#xml shape field
shape_points = " ".join(
    f"{(x - minx) * feet_to_m:.2f} {(y - miny) * feet_to_m:.2f}" for x, y in hull_coords
)

# Convert Z coordinates to meters
z_min_m = z_min_ft * feet_to_m
z_max_m = z_max_ft * feet_to_m
height_m = z_max_m - z_min_m

# ==== XML GENERATION ====
xml_str = f"""<?xml version="1.0"?>
<environment>
    <object
        fill-color="150 150 200"
        material="concrete"
        opacity="0.8"
        orientation="0 0 0"
        position="min 500 500 0"
        shape="prism {shape_points}"
        height="{height_m:.2f}"
    />
</environment>
"""

# ==== OUTPUT ====
print(xml_str)

with open("building_prism.xml", "w") as f:
    f.write(xml_str)